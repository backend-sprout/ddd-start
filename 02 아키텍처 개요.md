# 4개의 영역 
   
### 표현/UI    
사용자의 **요청을 해석해서 응용 서비스에 전달**하고        
응용 서비스의 **결과를 사용자가 이해할 수 있는 형식으로 변환해서 응답**한다.          

**여기서 사용자란? 🤔**   
```
사용자는 웹 브라우저이거나, 
REST API를 이용한 외부 시스템일 수 있다.(모바일, 기타 등등)   
```
       
즉, `HTTP 요청`을 **응용 영역이 필요로 하는 형식으로 변환**해서 응용 영역에 전달하고           
`응용 영역의 응답`을 **HTTP 응답으로 변환해서 전송한다.**(REST 데이터, Model은 전달이 아니기에 뺐습니다.)          
       
쉽게 말하면,       
`@RequestBody`를 이용해서 `사용자`로부터 넘어온 값을 `HTTP 요청 본문에 담긴 값들을 자바 객체로 변환`한 후 `Service`에 넘기고           
`@ResponseBody`를 이용해서 `Servic`로부터 넘어온 값을 `HTTP 응답 본문의 JSON 객체로 변환`한 후 응답하는 것을 말한다.          
즉, `Controller`가 대표적인 예시라고 보면 된다. (MVC라고 책에서는 나왔는데 더 자세히 말하면)        
       
### 응용   
사용자에게 **제공해야 할 기능을 구현한다.**       
`주문 등록`, `주문 취소`, `상품 상세 조회` 등등...      
        
`응용 영역`은 기능을 구현하기 위해 **도메인 영역의 도메인 모델들을 이용한다.**     

```java
public class CancelOrderService {
      
    @Transactional    
    public void cancelOrder(String orderId) {    
        Order order = findOrderById(orderId);     
        if(order == null) throw new OrderNotFoundException(orderId);      
        order.cancel();   
    }
}  
```  
응용 서비스는 로직을 직접 수행하기 보다는        
**도메인 모델에 로직 수행을 위임한다.(역할과 책임, 저는 협력하는 공간으로도 생각합니다.)**           
위 코드도 도메인인 `Order`가 `취소 처리`를 하고 있다.     

### 도메인  
도메인 영역은 **`도메인 모델`을 구현하는 영역**이다.     
`Order`, `OrderLine`, `ShippingInfo` 등등...   
그리고 **`도메인 모델`은 도메인의 핵심 로직을 구현**한다.     
     
**주문 도메인**     
* 배송지 변경    
* 결제 완료        
* 주문 총액 계산    

### 인프라스트럭처
인프라스트럭처 영역은 **구현 기술**에 대한 것을 다룬다.     

* `RDBMS` 연동처리
* [메시징 큐](https://ko.wikipedia.org/wiki/%EB%A9%94%EC%8B%9C%EC%A7%80_%ED%81%90)에 메시지 전송하거나 수신    
* `몽고 DB`, `HBase` 를 사용해서 데이터베이스 연동 처리  
* `SMTP`를 이용한 메일 발송 기능 구현      
* `HTTP 클라이언트`를 이용해서 `REST API`를 호출     
  
인프라스트럭처 영역은      
논리적인 개념을 표현하기 보다는 **실제 구현을 다룬다.**      

`도메인 로직`, `응용 영역`, `표현 영역`은 **구현 기술을 사용한 코드를 직접 만들지는 않는다.**   
대신, **인프라스트럭처 영역에서 제공하는 기능을 사용해서 필요한 기능을 개발한다.**    
  
예시1)        
1. 응용 영역이 DB에 보관된 데이터가 필요
2. 인프라스트럭처 영역의 DB 모듈을 사용해서 데이터를 읽어온다.   
       
예시2)       
1. SMTP 연동 모듈을 이용해서 메일 발송    
    
사실 여기서 가장 중요하다고 생각하는 점은 **관심사 분리**이다.      
`도메인 로직`, `응용 영역`, `표현 영역`은 **구현 기술을 어떻게 사용했는지 관심이 없다.**         
오로지 `데이터`만을 필요로 하고 **그 데이터를 잘 가공하는 역할만을 한다.**      
즉, 자신의 역할과 책임 -> `코어 밸류`만을 생각할 뿐이다.      
  
# 계층 구조 아키텍처     
`4 영역`을 구성할 때 많이 사용하는 아키텍처가 아래와 같은 구조이다.   
    
[사진](#)    
  
표현 영역과 응용 영역은 도메인 영역을 사용하고,   
도메인 영역은 인프라스트럭처 영역을 사용하므로 계층 구조가 적당해보인다.   
도메인 복잡도에 따라 응용과 도메인을 분리하기도 하고     
한 계층으로 합치기도 한다.       

계층 구조는 특성상    
**`상위 계층`에서 `하위 계층`으로의 의존만 존재**하고       
**`하위 계층`은 `상위 계층`에 의존하지 않는다.**     

```java
@Controller
public class SampleController {
    private final SampleService sampleService; // 하위를 의존
    
    public SampleController(SampleService sampleService) {
        this.sampleService = sampleService;
    }
    ... // 
}
```
   
계층 구조를 엄격하게 적용하면        
`상위 계층`은 바로 아래의 `하위 계층`에만 의존해야하지만     
구현의 편리상, **계층 구조를 유연하게 적용할 수 있다.**     
   
[사진](#)  
  
`룰 엔진`에 대해서는 설명부탁드릴게요       


```java
@Service
public class SampleServiceImpl implements SampleService {
  
    private final SampleRepository sampleRepository; // 도메인이 아닌 인프라스트럭처 영역  
                                                     // 상위 계층에 대한 의존이 없다.  
                                                     
    public SampleServiceImpl(SampleRepository sampleRepository) {
        this.sampleRepository = sampleRepository;
    }
    
    public void findById(Long id) {
        // 여기서 도메인을 얻어온다.   
        Sample sample = sampleRepository.findById(id).orElseThrow(() ->
                new NoSearchSampleByIdException(id));
    }
    
}
```








